<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tập thể lớp 9/10 chúc cô 20/11 vui vẻ — Fullscreen Fantasy</title>
<style>
  :root{
    --bg1:#05060b; --bg2:#0b0f1c; --bg3:#111325;
    --accent:#ff83c5; --accent2:#ffb2e3; --accent3:#ffd5f0;
    --glow:#ff8bd1; --text:#ffffff;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:
      radial-gradient(1200px 800px at 70% 10%, rgba(160,60,160,.08), transparent 40%),
      radial-gradient(900px 700px at 20% 80%, rgba(60,120,255,.06), transparent 40%),
      linear-gradient(180deg, var(--bg1), var(--bg2) 60%, var(--bg3));
    overflow:hidden;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }

  .noise{
    position:fixed; inset:-50%; pointer-events:none; opacity:.06; mix-blend-mode:screen;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.7"/></svg>');
    animation: drift 16s linear infinite;
  }
  @keyframes drift{from{transform:translate3d(0,0,0)} to{transform:translate3d(50px,0,0)}}

  #bgvid{
    position:fixed; inset:0; width:100%; height:100%;
    object-fit:cover; filter:brightness(.25) blur(2px) saturate(1.15);
    opacity:0; transition:opacity .6s ease;
  }
  body.showVideo #bgvid{opacity:.95}

  #fx{position:fixed; inset:0; width:100%; height:100%; display:block; touch-action:none}

  .center{position:fixed; inset:0; display:grid; place-items:center; pointer-events:none}
  .copy{ text-align:center; padding:2rem 1rem; }
  .headline{
    --shine1:#fff; --shine2:#ffe7f6; --shine3:#ffd2f0; --shadow: rgba(255,139,209,.35);
    font-weight:900; letter-spacing:.6px; line-height:1.15; color:transparent;
    font-size:clamp(24px, 5.2vw, 64px);
    background:linear-gradient(90deg, var(--shine1), var(--shine2), var(--shine3), var(--shine1));
    background-size:300% 100%; -webkit-background-clip:text; background-clip:text;
    filter: drop-shadow(0 8px 30px var(--shadow));
    opacity:0; transform:translateY(10px) scale(.98);
    animation: headlineIn 1.2s ease forwards .2s, sheen 8s ease-in-out infinite 1.4s;
  }
  @keyframes sheen{0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%}}
  @keyframes headlineIn{to{opacity:1; transform:translateY(0) scale(1)}}

  .headline .char{
    display:inline-block; opacity:0;
    transform: translateY(12px) rotate(0.5deg) scale(.96);
    filter: blur(4px);
  }
  .headline .char.show{ animation: charPop .9s cubic-bezier(.2,.7,.2,1) forwards; }
  @keyframes charPop{
    0%{opacity:0; transform:translateY(18px) scale(.9); filter:blur(8px)}
    60%{opacity:1; transform:translateY(-4px) scale(1.04); filter:blur(0)}
    100%{opacity:1; transform:translateY(0) scale(1)}
  }

  /* Chữ rơi nhỏ */
  .fallingText {
    position: fixed;
    top: -40px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 18px;
    font-weight: 700;
    pointer-events: none;
    white-space: nowrap;
    color: transparent;

    --base-grad: linear-gradient(90deg, #ffd5f0, #ffb2e3, #ff83c5, #ffd5f0);
    --shine-grad: linear-gradient(120deg, transparent 16%, rgba(255,255,255,.9) 46%, rgba(255,200,240,.6) 54%, transparent 84%);
    background-image: var(--shine-grad), var(--base-grad);
    background-size: 200% 100%, 300% 100%;
    background-clip: text;
    -webkit-background-clip: text;

    animation: fall linear forwards, shineSweep 3.6s linear infinite;
  }

  @keyframes fall {
    0%   { transform: translateY(-60px) translateX(var(--x)); opacity: 0; }
    10%  { opacity: 1; }
    100% { transform: translateY(120vh) translateX(var(--x)); opacity: 0; }
  }

  @keyframes shineSweep {
    0% { background-position: -200% 0, 0 50% }
    100% { background-position: 200% 0, 0 50% }
  }

  /* ========== LOTUS BLOOM INTRO CSS ========== */
  #lotusIntro{
    position:fixed; inset:0; z-index:999999;
    pointer-events:none;
    background:
      radial-gradient(160vmax 90vmax at 50% 45%, rgba(255,200,245,.06), transparent 42%),
      radial-gradient(circle at 50% 55%, #0a0212 0%, #05000a 55%, #000 100%);
  }
  .lotusWrap{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:70vmin; height:70vmin; }

  .petal{
    position:absolute; left:50%; top:50%;
    width:14vmin; height:26vmin;
    transform-origin:50% 88%;
    transform:translate(-50%,-88%) rotate(var(--rot)) scale(.12);
    opacity:0;
    clip-path: ellipse(50% 65% at 50% 35%);
    background: radial-gradient(50% 65% at 50% 35%,
                rgba(255,255,255,.95) 0%,
                #ffd2f2 28%, #ff9edd 56%, rgba(255,158,221,0) 70%);
    filter: drop-shadow(0 0 18px rgba(255,140,220,.55));
    animation:
      petalIn 1.6s cubic-bezier(.2,.8,.2,1) forwards var(--delay),
      petalBreathe 3.6s ease-in-out infinite calc(var(--delay) + 1.7s);
  }
  @keyframes petalIn{
    0%{ opacity:0; transform:translate(-50%,-88%) rotate(var(--rot)) scale(.05); filter:blur(10px) }
    60%{ opacity:1 }
    100%{ opacity:1; transform:translate(-50%,-88%) rotate(var(--rot)) scale(1) }
  }
  @keyframes petalBreathe{
    0%,100%{ filter: drop-shadow(0 0 14px rgba(255,140,220,.5)) }
    50%{ filter: drop-shadow(0 0 28px rgba(255,170,240,.9)) }
  }

  #lotusCore{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    width:20vmin; height:20vmin; border-radius:50%;
    background: radial-gradient(circle at 50% 45%, #fff 0%, #ffe5f7 35%, rgba(255,210,245,.12) 62%, rgba(255,210,245,0) 70%);
    box-shadow:0 0 60px rgba(255,160,240,.6), 0 0 120px rgba(170,0,170,.25);
    animation: corePulse 2.4s ease-in-out infinite 1s;
  }
  @keyframes corePulse{
    0%,100%{ transform:translate(-50%,-50%) scale(1) }
    50%{ transform:translate(-50%,-50%) scale(1.08) }
  }

  .ripple{
    position:absolute; left:50%; top:50%;
    width:24vmin; height:24vmin; transform:translate(-50%,-50%);
    border:2px solid rgba(255,180,240,.55); border-radius:50%; opacity:0;
    animation:ripple 3.6s ease-out infinite;
  }
  .ripple.r2{ animation-delay:.9s } .ripple.r3{ animation-delay:1.8s }

  @keyframes ripple{
    0%{ opacity:.9; transform:translate(-50%,-50%) scale(.2) }
    80%{ opacity:.15 }
    100%{ opacity:0; transform:translate(-50%,-50%) scale(2.8) }
  }

  .spark{
    position:absolute; left:50%; top:50%;
    width:6px; height:6px; border-radius:50%;
    background: radial-gradient(circle,#fff 0%, #ffd5f5 60%, rgba(255,200,245,0) 75%);
    filter: drop-shadow(0 0 16px rgba(255,180,245,.9));
    opacity:0; transform:translate(-50%,-50%) scale(.8);
    animation: sparkOut 1.1s cubic-bezier(.2,.7,.2,1) forwards var(--d);
  }
  @keyframes sparkOut{
    10%{ opacity:1 }
    100%{ opacity:0; transform:translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(.2) }
  }

  /* Curtain mở chuyển sang main scene */
  #lotusCurtain{
    position:absolute; left:50%; top:50%;
    width:24vmin; height:24vmin; border-radius:50%;
    transform:translate(-50%,-50%) scale(.2);
    background: radial-gradient(circle, rgba(255,255,255,.95) 0%, rgba(255,200,245,.75) 40%, rgba(255,200,245,0) 60%);
    filter:blur(10px); opacity:0;
  }
  #lotusCurtain.go{ animation: curtainOpen 1.1s ease-out forwards }
  @keyframes curtainOpen{
    0%{ opacity:0; transform:translate(-50%,-50%) scale(.2) }
    40%{ opacity:1 }
    100%{ opacity:0; transform:translate(-50%,-50%) scale(12) }
  }

  @media (max-width:480px){
    #lotusCore{ width:26vmin; height:26vmin }
    .petal{ width:16vmin; height:30vmin }
  }
  /* VÔ HIỆU HÓA ẩn intro khi reduce-motion bật */
  @media (prefers-reduced-motion:reduce){
      #lotusIntro{ display:block !important }
  }
  /* Fade-out mượt cho toàn bộ intro */
  #lotusIntro.fade-out{
    animation: lotusFadeOut .9s ease-out forwards;
  }

  @keyframes lotusFadeOut{
    0%  { opacity:1; }
    100%{ opacity:0; }
  }

</style>
</head>

<body>

  <!-- INTRO HOA SEN -->
  <div id="lotusIntro">
    <div class="lotusWrap" id="lotusWrap"></div>

    <!-- NHÂN HOA SEN (CẦN THÊM DÒNG NÀY) -->
    <div id="lotusCore"></div>

    <!-- GỢN SÓNG -->
    <div class="ripple r1"></div>
    <div class="ripple r2"></div>
    <div class="ripple r3"></div>

    <!-- RÈM MỞ CHUYỂN CẢNH -->
    <div id="lotusCurtain"></div>
  </div>


<!-- chữ rơi -->
<div id="rainContainer"></div>

<video id="bgvid" muted loop playsinline></video>
<canvas id="fx"></canvas>
<div class="noise" aria-hidden="true"></div>

<div class="center">
  <div class="copy">
    <h1 class="headline" id="headline">Tập thể lớp 9/10 chúc cô 20/11 vui vẻ</h1>
  </div>
</div>

<!-- Dòng chữ dưới trái tim -->
<div id="belowHeart"></div>
<script>
(() => {

  /* ==========================
     HÀM BẮT ĐẦU MAIN SCENE
     (TRÁI TIM + CHỮ + CHỮ RƠI)
  ========================== */
  function startMainScene(){
    // setup canvas lần đầu
    resize();
    // bật animation cho headline
    initHeadline();
    // chạy render loop
    requestAnimationFrame(render);
    // bắt đầu chữ rơi
    spawnFallingText();
    // nổ 1 cú burst ở giữa sau 1 chút
    setTimeout(()=> spawnBurst(window.innerWidth/2, window.innerHeight/2, 200, 1.4), 1200);
  }

  /* ==========================
     LOTUS INTRO SYSTEM
  ========================== */
  function createLotusIntro() {

    const wrap = document.getElementById("lotusWrap");
    const curtain = document.getElementById("lotusCurtain");
    const intro = document.getElementById("lotusIntro");

    /* ---- tạo 18 cánh hoa ---- */
    for (let i = 0; i < 18; i++) {
      const p = document.createElement("div");
      p.className = "petal";
      p.style.setProperty("--rot", `${(i / 18) * 360}deg`);
      p.style.setProperty("--delay", `${i * 0.06}s`);
      wrap.appendChild(p);
    }

    /* ---- tạo spark ánh sáng bay ra ---- */
    for (let i = 0; i < 60; i++) {
      const sp = document.createElement("div");
      sp.className = "spark";
      const ang = Math.random() * Math.PI * 2;
      const dist = Math.random() * 120 + 40;
      sp.style.setProperty("--tx", `${Math.cos(ang) * dist}px`);
      sp.style.setProperty("--ty", `${Math.sin(ang) * dist}px`);
      sp.style.setProperty("--d", `${0.8 + Math.random()*1.4}s`);
      wrap.appendChild(sp);
    }

    /* ---- mở rèm chuyển cảnh (bùng sáng) ---- */
    setTimeout(() => {
      curtain.classList.add("go");
    }, 2600);

    /* ---- BẮT ĐẦU MAIN SCENE khi rèm đang mở dần ---- */
    setTimeout(() => {
      startMainScene();
    }, 3200);

    /* ---- FADING intro đi thay vì tắt cái bụp ---- */
    setTimeout(() => {
      intro.classList.add("fade-out");
    }, 3600);

    /* ---- remove hẳn khỏi DOM sau khi fade xong ---- */
    setTimeout(() => {
      intro.remove();
    }, 4600);
  }


  /* KHỞI ĐỘNG INTRO */
  createLotusIntro();


  /* ==========================
     SETUP CANVAS + PARTICLES
  ========================== */

  const dpr = Math.min(window.devicePixelRatio || 1, 2);
  const canvas = document.getElementById('fx');
  const ctx = canvas.getContext('2d');
  const vid = document.getElementById('bgvid');
  const below = document.getElementById('belowHeart');
  let W, H, CX, CY, R;

  const COARSE = window.matchMedia('(pointer:coarse)').matches;

  function resize(){
    W = canvas.width = Math.floor(window.innerWidth * dpr);
    H = canvas.height = Math.floor(window.innerHeight * dpr);
    canvas.style.width = '100%'; canvas.style.height = '100%';
    ctx.setTransform(1,0,0,1,0,0);
    ctx.scale(dpr, dpr);
    CX = W/dpr/2;
    CY = H/dpr/2;
    R = Math.min(CX, CY)*0.6;
    positionBelow();
  }
  window.addEventListener('resize', resize, {passive:true});
  // ❌ không gọi resize() ngay, đợi startMainScene() gọi


  /* ==========================
     ANIMATION TITLE POP-IN
     (đưa vào hàm để gọi sau intro)
  ========================== */
  const headline = document.getElementById('headline');
  const raw = headline.textContent;
  headline.textContent = '';

  function initHeadline(){
    [...raw].forEach((ch, i) => {
      const span = document.createElement('span');
      span.className = 'char';
      span.textContent = ch;
      headline.appendChild(span);
      setTimeout(() => span.classList.add('show'), 40 * i + 300);
    });
  }

  /* ==========================
     HEART PATH
  ========================== */
  function heartPoint(t){
    const x = 16 * Math.sin(t)**3;
    const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
    return {x: x/18, y: -y/18};
  }
  function samplePath(steps=400){
    const pts = [];
    for(let i=0;i<=steps;i++){
      const t = (i/steps) * Math.PI * 2;
      pts.push(heartPoint(t));
    }
    return pts;
  }
  const basePath = samplePath(800);

  /* ==========================
     PARTICLES
  ========================== */
  const particles = [];
  const ripples = [];

  function spawnParticle(x, y, speed=1){
    const a = Math.atan2(y-CY, x-CX) + (Math.random()-0.5)*0.7;
    const v = (Math.random()*0.8 + 0.4) * speed;
    particles.push({
      x, y,
      vx: Math.cos(a)*v,
      vy: Math.sin(a)*v,
      life: 0,
      max: 60 + Math.random()*60,
      size: 1 + Math.random()*2,
      hue: 320 + Math.random()*30,
      sat: 80 + Math.random()*20,
      light: 55 + Math.random()*10
    });
  }

  function spawnBurst(x, y, n=120, sp=1){
    for(let i=0;i<n;i++) spawnParticle(x, y, sp);
  }

  /* ==========================
     HEART BEAT
  ========================== */
  let t0 = performance.now();
  let dashOffset = 0;
  let beatTimer = 0;
  const beatInterval = 1050;

  function onBeat(){
    ripples.push({r: R*0.4, a: 1});
    for(let i=0;i<80;i++){
      const p = basePath[(Math.random()*basePath.length)|0];
      const x = CX + p.x * R;
      const y = CY + p.y * R;
      spawnParticle(x,y, 1.6);
    }
  }

  function positionBelow(){
    const margin = 28;
    let top = CY + R + margin;
    const bottomLimit = window.innerHeight - 24;
    if(top > bottomLimit) top = bottomLimit;
    below.style.position = 'fixed';
    below.style.left = '50%';
    below.style.transform = 'translateX(-50%)';
    below.style.top = `${top}px`;
  }

  /* ==========================
     RENDER LOOP
  ========================== */
  const STAR_COUNT = COARSE ? 140 : 220;
  const stars = Array.from({length: STAR_COUNT}, () => ({
    x: Math.random()*window.innerWidth,
    y: Math.random()*window.innerHeight,
    r: Math.random()*1.1 + 0.3,
    tw: Math.random()*360
  }));

  function starfield(){
    for(const s of stars){
      s.tw += 0.8;
      const a = (Math.sin(s.tw*Math.PI/180)*0.5 + 0.5) * 0.7 + 0.1;
      ctx.beginPath();
      ctx.fillStyle = `rgba(255,255,255,${a})`;
      ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
      ctx.fill();
    }
  }

  function render(now){
    const dt = Math.max(16, now - t0);
    t0 = now;

    beatTimer += dt;
    if(beatTimer > beatInterval){
      beatTimer -= beatInterval;
      onBeat();
    }

    ctx.clearRect(0,0,canvas.width/dpr, canvas.height/dpr);

    starfield();

    const beat = 0.9 + 0.06*Math.sin((now/beatInterval)*Math.PI*2);

    ctx.save();
    ctx.translate(CX, CY);
    ctx.scale(beat, beat);

    ctx.lineWidth = 3;
    ctx.strokeStyle = '#ff7abc';
    ctx.shadowColor = 'rgba(255,136,209,0.9)';
    ctx.shadowBlur = 24;
    ctx.beginPath();
    for(let i=0;i<basePath.length;i++){
      const p = basePath[i];
      const x = p.x * R, y = p.y * R;
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.closePath();

    const dashLen = 120, gap = 14;
    dashOffset = (dashOffset + dt*0.08) % (dashLen+gap);
    ctx.setLineDash([dashLen, gap]);
    ctx.lineDashOffset = -dashOffset;

    ctx.stroke();

    const g = ctx.createRadialGradient(0,0, R*0.1, 0,0, R*0.9);
    g.addColorStop(0, 'rgba(255,166,222,0.35)');
    g.addColorStop(1, 'rgba(255,110,190,0.02)');
    ctx.fillStyle = g;
    ctx.fill();

    ctx.restore();

    /* RIPPLES */
    for(let i=ripples.length-1; i>=0; i--){
      const rp = ripples[i];
      rp.r += dt*0.12;
      rp.a *= 0.985;
      if(rp.a < 0.02){
        ripples.splice(i,1);
        continue;
      }
      ctx.beginPath();
      ctx.arc(CX, CY, rp.r, 0, Math.PI*2);
      ctx.strokeStyle = `rgba(255, 150, 220, ${rp.a*0.4})`;
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    /* PARTICLES */
    ctx.save();
    ctx.globalCompositeOperation = 'lighter';
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.life += 1;
      p.x += p.vx;
      p.y += p.vy;
      p.vx *= 0.995;
      p.vy *= 0.995;
      const fade = 1 - p.life/p.max;
      if(fade <= 0){
        particles.splice(i,1);
        continue;
      }
      ctx.beginPath();
      ctx.fillStyle = `hsla(${p.hue}, ${p.sat}%, ${p.light}%, ${Math.max(.08, .6*fade)})`;
      ctx.arc(p.x, p.y, p.size * (1+0.6*(1-fade)), 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();

    requestAnimationFrame(render);
  }

  /* ==========================
     INTERACTION
  ========================== */
  let lastX = null, lastY = null, lastTime = 0;

  window.addEventListener('pointermove', e => {
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left);
    const y = (e.clientY - rect.top);

    const now = performance.now();
    const dt = now - lastTime;

    const dx = lastX==null ? 0 : x - lastX;
    const dy = lastY==null ? 0 : y - lastY;
    const dist = Math.hypot(dx, dy);

    if(dt > 14){
      const base = COARSE ? 2 : 4;
      const mult = COARSE ? 0.25 : 0.4;
      const maxN = COARSE ? 40 : 60;
      const n = Math.min(maxN, base + Math.floor(dist*mult));
      const sp = 0.9 + Math.min(1.2, dist*0.02);
      spawnBurst(x, y, n, sp);

      lastTime = now;
      lastX = x;
      lastY = y;
    }
  }, {passive:true});


  /* ==========================
     VIDEO BACKGROUND
  ========================== */

  function tryPlayVideo(){ if(vid.src) vid.play().catch(()=>{}); }

  document.addEventListener('paste', (e)=>{
    const item = [...e.clipboardData.items].find(i=> i.kind==='file' && i.type.startsWith('video/'));
    if(item){
      const file = item.getAsFile();
      setVideo(URL.createObjectURL(file));
    }
  });

  window.addEventListener('dragover', e=>{ e.preventDefault(); });
  window.addEventListener('drop', (e)=>{
    e.preventDefault();
    const file = [...e.dataTransfer.files][0];
    if(file && file.type.startsWith('video/'))
      setVideo(URL.createObjectURL(file));
  });

  fetch('1111.mp4', {method:'HEAD'})
    .then(r=>{ if(r.ok){ setVideo('1111.mp4'); }})
    .catch(()=>{});

  function setVideo(src){
    vid.src = src;
    document.body.classList.add('showVideo');
    tryPlayVideo();
  }

  /* ==========================
     FALLING TEXT SYSTEM
  ========================== */

  const lines = [
    "Tập thể lớp 9/10 chúc cô 20/11 vui vẻ",
    "Kính chúc cô nhiều sức khỏe",
    "Chúc cô luôn vui vẻ và hạnh phúc",
    "Tập thể lớp 9/10 luôn yêu thương cô!",
    "Chúc cô một ngày 20/11 thật rực rỡ ✨",
  ];

  const rain = document.getElementById("rainContainer");

  function spawnFallingText() {
    const div = document.createElement("div");
    div.className = "fallingText";

    div.textContent = lines[Math.floor(Math.random() * lines.length)];

    const x = (Math.random() * 90 - 45) + "vw";
    div.style.setProperty("--x", x);

    const duration = Math.random() * 3 + 4;
    div.style.animationDuration = duration + "s";

    rain.appendChild(div);

    setTimeout(() => div.remove(), duration * 1000);
    setTimeout(spawnFallingText, 500 + Math.random() * 800);
  }

  // ❌ KHÔNG gọi spawnFallingText ở đây nữa
  // spawnFallingText();

})();
</script>

</body>
</html>
